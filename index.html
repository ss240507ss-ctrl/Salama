        <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Salama">
    <title>Salama</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d9488">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Supabase Configuration
        const SUPABASE_URL = 'https://gqgsmhqpixvqxkynpotc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdxZ3NtaHFwaXh2cXhreW5wb3RjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxMDA3NjMsImV4cCI6MjA4NTY3Njc2M30.sbscrW-ho5JnwtAo1732bb5q5kBfkkzxrTmPjAIe8u4';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        const User = ({className}) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );
        
        const Mic = ({className}) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
        );
        
        const Keyboard = ({className}) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M8 12h.01M12 12h.01M16 12h.01M7 16h10"></path>
            </svg>
        );
        
        const Users = ({className}) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const SalamaApp = () => {
          const [currentUser, setCurrentUser] = useState(null);
          const [isLoading, setIsLoading] = useState(true);
          const [showAuth, setShowAuth] = useState(false);
          const [authMode, setAuthMode] = useState('login');
          const [authForm, setAuthForm] = useState({ username: '', password: '', name: '', role: '' });
          const [showPassword, setShowPassword] = useState(false);
          const [currentPage, setCurrentPage] = useState('home');
          const [currentCardIndex, setCurrentCardIndex] = useState(0);
          const [selectedMood, setSelectedMood] = useState(null);
          const [isRecording, setIsRecording] = useState(false);
          const [showRecordings, setShowRecordings] = useState(false);
          const [sosPressed, setSosPressed] = useState(false);
          const [okPressed, setOkPressed] = useState(false);
          const [showSidebar, setShowSidebar] = useState(false);
          const [chatWith, setChatWith] = useState(null);
          const [showCommunities, setShowCommunities] = useState(false);
          const [chatMessages, setChatMessages] = useState([]);
          const [messageInput, setMessageInput] = useState('');
          const [showProtectionChat, setShowProtectionChat] = useState(false);
          const [protectionMessages, setProtectionMessages] = useState([]);
          const [protectionInput, setProtectionInput] = useState('');
          const [isAIThinking, setIsAIThinking] = useState(false);
          const [backgroundMonitoring, setBackgroundMonitoring] = useState(true);
          const [monitoringAlerts, setMonitoringAlerts] = useState([]);
          const [showQRCode, setShowQRCode] = useState(false);
          const [showQRScanner, setShowQRScanner] = useState(false);
          const [qrCodeData, setQRCodeData] = useState('');
          const [currentTime, setCurrentTime] = useState(new Date());
          const [caregivers, setCaregivers] = useState([]);

          useEffect(() => {
            checkUser();
            const timer = setInterval(() => setCurrentTime(new Date()), 1000);
            return () => clearInterval(timer);
          }, []);

          useEffect(() => {
            if (currentUser && currentUser.role === 'care_recipient') {
              loadCaregivers();
            }
          }, [currentUser]);

          const checkUser = async () => {
            const userId = localStorage.getItem('salamaUserId');
            if (userId) {
              const { data, error } = await supabase
                .from('users')
                .select('*')
                .eq('id', userId)
                .single();
              if (data) setCurrentUser(data);
            }
            setIsLoading(false);
          };

const handleAuth = async (e) => {
  e.preventDefault();
  
  try {
    if (authMode === 'login') {
      const { data, error } = await supabase
        .from('users')
        .select('*')
        .eq('username', authForm.username)
        .eq('password', authForm.password)
        .single();
      
      if (error || !data) {
        alert('Invalid username or password. Please try again.');
        return;
      }
      
      setCurrentUser(data);
      localStorage.setItem('salamaUserId', data.id);
      setShowAuth(false);
      setAuthForm({ username: '', password: '', name: '', role: '' });
      
    } else {
      // Signup mode
      
      // Validate all fields
      if (!authForm.username || !authForm.password || !authForm.name || !authForm.role) {
        alert('Please fill in all fields');
        return;
      }
      
      // Check if username exists
      const { data: existingUser } = await supabase
        .from('users')
        .select('*')
        .eq('username', authForm.username)
        .maybeSingle();
      
      if (existingUser) {
        alert('Username already exists. Please choose a different username.');
        return;
      }

      const newUser = {
        username: authForm.username.trim(),
        password: authForm.password,
        name: authForm.name.trim(),
        role: authForm.role,
        avatar: authForm.role === 'care_recipient' ? 'üë¥' : 'üë®‚Äç‚öïÔ∏è',
        care_circle_id: authForm.role === 'care_recipient' ? crypto.randomUUID() : null
      };

      const { data, error } = await supabase
        .from('users')
        .insert([newUser])
        .select()
        .single();

      if (error) {
        console.error('Signup error:', error);
        alert('Error creating account: ' + error.message);
        return;
      }

      if (data) {
        setCurrentUser(data);
        localStorage.setItem('salamaUserId', data.id);
        setAuthForm({ username: '', password: '', name: '', role: '' });
        
        if (data.role === 'care_recipient') {
          setTimeout(() => {
            generateQRCode(data.care_circle_id);
            setShowQRCode(true);
          }, 500);
        }
        
        setShowAuth(false);
      }
    }
  } catch (err) {
    console.error('Auth error:', err);
    alert('An error occurred. Please try again.');
  }
};

          const generateQRCode = async (circleId) => {
            const qrContainer = document.getElementById('qr-code-container');
            if (qrContainer) {
              qrContainer.innerHTML = '';
              await QRCode.toCanvas(qrContainer, circleId, { width: 300 });
            }
            setQRCodeData(circleId);
          };

          const startQRScanner = () => {
            setShowQRScanner(true);
            setTimeout(() => {
              const html5QrCode = new Html5Qrcode("qr-reader");
              html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                async (decodedText) => {
                  html5QrCode.stop();
                  await joinCareCircle(decodedText);
                  setShowQRScanner(false);
                },
                (errorMessage) => {}
              );
            }, 100);
          };

          const joinCareCircle = async (circleId) => {
            const { data: circle } = await supabase
              .from('users')
              .select('*')
              .eq('care_circle_id', circleId)
              .eq('role', 'care_recipient')
              .single();

            if (circle) {
              await supabase
                .from('caregivers')
                .insert([{
                  care_circle_id: circleId,
                  caregiver_user_id: currentUser.id
                }]);
              
              alert(`Successfully joined ${circle.name}'s care circle!`);
              loadCaregivers();
            } else {
              alert('Invalid QR code');
            }
          };

          const loadCaregivers = async () => {
            if (!currentUser || currentUser.role !== 'care_recipient') return;
            
            const { data } = await supabase
              .from('caregivers')
              .select('caregiver_user_id')
              .eq('care_circle_id', currentUser.care_circle_id);

            if (data && data.length > 0) {
              const caregiverIds = data.map(c => c.caregiver_user_id);
              const { data: caregiversData } = await supabase
                .from('users')
                .select('*')
                .in('id', caregiverIds);
              
              setCaregivers(caregiversData || []);
            }
          };

          const sendMessage = async () => {
            if (!messageInput.trim() || !chatWith) return;
            
            const message = {
              from_user_id: currentUser.id,
              to_user_id: chatWith.id,
              message_text: messageInput,
              timestamp: new Date().toISOString()
            };

            await supabase.from('messages').insert([message]);
            
            setChatMessages([...chatMessages, {
              text: messageInput,
              sender: "me",
              time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            }]);
            setMessageInput('');
          };

          const loadMessages = async (userId) => {
            const { data } = await supabase
              .from('messages')
              .select('*')
              .or(`from_user_id.eq.${currentUser.id},to_user_id.eq.${currentUser.id}`)
              .or(`from_user_id.eq.${userId},to_user_id.eq.${userId}`)
              .order('timestamp', { ascending: true });

            if (data) {
              setChatMessages(data.map(m => ({
                text: m.message_text,
                sender: m.from_user_id === currentUser.id ? 'me' : 'them',
                time: new Date(m.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
              })));
            }
          };

          const logout = () => {
            localStorage.removeItem('salamaUserId');
            setCurrentUser(null);
            setShowAuth(true);
          };

          const moods = [
            { emoji: 'üò°', color: 'bg-red-500' },
            { emoji: 'üòü', color: 'bg-orange-500' },
            { emoji: 'üòê', color: 'bg-yellow-500' },
            { emoji: 'üôÇ', color: 'bg-lime-500' },
            { emoji: 'üòä', color: 'bg-green-500' }
          ];

          const recordings = [
            'Recording 1 - Today 10:00 AM',
            'Recording 2 - Yesterday 3:00 PM',
            'Recording 3 - Jan 28 9:00 AM'
          ];

          const homeCards = [
            { title: 'Medication üíä', items: ['Med 1 - 8:00', 'Med 2 - 8:00 & 19:00', 'Med 3 - 11:00'] },
            { title: 'Appointments üìÖ', items: ['Dr. Smith - 14:00', 'Physical Therapy - 16:00'] },
            { title: 'Exercise üèÉ', items: ['Morning Walk - Completed', 'Stretching - Pending'] }
          ];

          const careNotesCards = [
            { title: 'Documents üìÅ', items: ['Test Results', 'Lab Reports', 'X-Rays', 'MRIs'], preview: true },
            { title: 'Prescriptions üíä', items: ['Blood Pressure Meds', 'Diabetes Medication', 'Vitamins'], preview: true },
            { title: 'Other Expenses üí∞', items: ['Salaries', 'Diapers', 'Medical Supplies', 'Transportation'], preview: false }
          ];

          const quickTexts = [
            'I fell',
            'Mistreated',
            'I feel sick',
            'I need to go to the hospital',
            '(Customizable message)'
          ];

          const communities = [
            { id: 'internal', name: 'Internal (Caregivers)' },
            { id: 'group1', name: 'External (Support Group 1)' },
            { id: 'group2', name: 'External (Support Group 2)' },
            { id: 'group3', name: 'External (Support Group 3)' }
          ];

          const handleSwipe = () => {
            if (currentPage === 'home') {
              setCurrentCardIndex((prev) => (prev + 1) % homeCards.length);
            } else if (currentPage === 'carenotes') {
              setCurrentCardIndex((prev) => (prev + 1) % careNotesCards.length);
            }
          };

         

          const renderNavBar = () => (
            <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-teal-700 flex justify-around items-center py-2 z-50">
              {[
                { id: 'home', label: 'Home', icon: 'üè†' },
                { id: 'checkin', label: 'Check-In', icon: 'üìù' },
                { id: 'carenotes', label: 'Care Notes', icon: 'üìã' },
                { id: 'safety', label: 'Safety', icon: 'üõ°Ô∏è' },
                { id: 'carecircle', label: 'Care-Circle', icon: 'üë•' }
              ].map((item) => (
                <button key={item.id} onClick={() => setCurrentPage(item.id)} className="flex flex-col items-center">
                  <span className="text-2xl mb-1">{item.icon}</span>
                  <span className={`text-xs ${currentPage === item.id ? 'text-teal-700 font-semibold' : 'text-teal-600'}`}>{item.label}</span>
                </button>
              ))}
            </div>
          );
const askSalama = async (question) => {
  setProtectionMessages(prev => [...prev, {
    text: question,
    sender: "me",
    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
  }]);
  setProtectionInput('');
  setIsAIThinking(true);

  try {
    // Call your Netlify Function instead of calling Gemini directly
    const response = await fetch('/.netlify/functions/ask-salama', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        question: question,
        conversationHistory: protectionMessages,
        userName: currentUser.name,
        userRole: currentUser.role
      })
    });

    const data = await response.json();
    
    if (data.response) {
      if (data.shouldAlert && currentUser.role === 'care_recipient') {
        console.log('üö® Alert sent to caregivers:', question);
        
        setTimeout(() => {
          setMonitoringAlerts([{
            message: `AI detected concern: "${question.substring(0, 50)}..." - Caregivers notified.`
          }]);
        }, 1000);
      }
      
      setProtectionMessages(prev => [...prev, {
        text: data.response,
        sender: "salama",
        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
      }]);
    } else if (data.fallback) {
      throw new Error('AI service unavailable');
    }
    
  } catch (error) {
    console.error('AI Error:', error);
    
    let fallbackResponse = "I'm here with you. ";
    const lq = question.toLowerCase();
    
    if (lq.includes('lonely') || lq.includes('alone')) {
      fallbackResponse += "I understand feeling lonely can be hard. Would you like to talk about what's on your mind, or shall I help you connect with someone from your care circle?";
    } else if (lq.includes('pain') || lq.includes('hurt')) {
      fallbackResponse += "I'm concerned to hear you're in pain. I'm notifying your caregivers right away. Can you describe where it hurts?";
    } else if (lq.includes('hello') || lq.includes('hi')) {
      fallbackResponse += "Hello! It's wonderful to hear from you. How can I help you today?";
    } else if (lq.includes('thank')) {
      fallbackResponse += "You're very welcome! I'm always here whenever you need me.";
    } else {
      fallbackResponse += "I'm having a small connection issue, but I'm here with you. If this is urgent, please use the SOS button or contact your caregiver directly.";
    }
    
    setProtectionMessages(prev => [...prev, {
      text: fallbackResponse,
      sender: "salama",
      time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    }]);
  }
  
  setIsAIThinking(false);
};
```

5. Scroll down and click **"Commit changes"**

---

### **Step 5: Verify Your Folder Structure**

Go back to the main page of your repository. You should now see:
```
üìÅ netlify
  üìÅ functions
    üìÑ ask-salama.js
üìÑ index.html
üìÑ netlify.toml
üìÑ manifest.json (if you had it)
üìÑ logo.png (if you had it)
```

---

## **Now Deploy to Netlify:**

### **Step 6: Sign Up for Netlify**

1. Go to **[netlify.com](https://netlify.com)**
2. Click **"Sign up"**
3. Choose **"Sign up with GitHub"**
4. Authorize Netlify to access your GitHub

---

### **Step 7: Deploy Your Site**

1. Click **"Add new site"** button
2. Select **"Import an existing project"**
3. Click **"Deploy with GitHub"**
4. Select your **Salama repository**
5. Leave all settings as default
6. Click **"Deploy site"**

Wait 1-2 minutes for deployment...

---

### **Step 8: Add Your Gemini API Key**

1. Once deployed, click **"Site settings"** (in the top menu)
2. In the left sidebar, click **"Environment variables"**
3. Click **"Add a variable"** button
4. Fill in:
   - **Key:** `GEMINI_API_KEY`
   - **Value:** Your actual Gemini API key (from Google AI Studio)
5. Click **"Create variable"**

---

### **Step 9: Redeploy with the API Key**

1. Go to the **"Deploys"** tab (top menu)
2. Click **"Trigger deploy"** dropdown
3. Select **"Clear cache and deploy site"**

Wait 1-2 minutes...

---

### **Step 10: Test Your Site! üéâ**

1. Click on your site URL (something like `https://your-site-name.netlify.app`)
2. Sign up or log in
3. Go to **Safety** page
4. Click **"Salama AI Companion"**
5. Type: "Hello, how are you?"
6. The AI should respond!

---

## **Troubleshooting:**

### **If you get "Function not found" error:**
- Make sure `netlify.toml` is in the root of your repo
- Make sure the path is exactly `netlify/functions/ask-salama.js`
- Redeploy (clear cache and deploy)

### **If AI doesn't respond:**
- Check you added the `GEMINI_API_KEY` environment variable
- Make sure you redeployed after adding it
- Check the Netlify function logs (Deploys ‚Üí Function logs)

### **If you get CORS errors:**
- This shouldn't happen with Netlify Functions
- Make sure you're using `/.netlify/functions/ask-salama` (with the leading `/`)

---

## **Quick Visual Summary:**
```
1. Create netlify.toml file ‚úÖ
   ‚Üì
2. Create netlify/functions/ask-salama.js file ‚úÖ
   ‚Üì
3. Update index.html ‚úÖ
   ‚Üì
4. Deploy to Netlify ‚úÖ
   ‚Üì
5. Add GEMINI_API_KEY environment variable ‚úÖ
   ‚Üì
6. Redeploy ‚úÖ
   ‚Üì
7. Test! üéâ
          const renderHeader = (title) => (
            <div className="flex justify-between items-center mb-8">
              <button onClick={() => setShowSidebar(!showSidebar)} className="w-14 h-14 rounded-full border-2 border-white flex items-center justify-center">
                <User className="w-8 h-8 text-white" />
              </button>
              <h1 className="text-4xl font-serif text-white">{title}</h1>
              <button onClick={() => { setSosPressed(true); setTimeout(() => setSosPressed(false), 300); alert('üö® SOS ALERT!'); }} className={`w-20 h-20 rounded-3xl bg-red-500 flex items-center justify-center transition-all ${sosPressed ? 'scale-95 animate-pulse' : 'hover:scale-105'}`}>
                <span className="text-white text-3xl font-bold">SOS</span>
              </button>
            </div>
          );

          const renderSwipeCard = (card) => {
            const totalCards = currentPage === 'home' ? homeCards.length : careNotesCards.length;
            return (
              <div className="relative">
                <div className="bg-white rounded-3xl p-8 shadow-2xl border-4 border-teal-700 mx-8 mb-4">
                  <div className="mb-6 pb-4 border-b-4 border-teal-700 flex justify-between">
                    <h3 className="text-2xl font-serif text-black">{card.title}</h3>
                    <span className="text-sm text-gray-600">{currentCardIndex + 1}/{totalCards}</span>
                  </div>
                  <div className="mb-8">
                    {card.items.map((item, idx) => (
                      <p key={idx} className="text-xl text-black mb-2">{idx + 1}. {item}</p>
                    ))}
                  </div>
                  {card.preview && (
                    <div className="mb-8">
                      <h4 className="text-2xl font-serif text-black text-center mb-4">Preview</h4>
                      <div className="w-48 h-48 mx-auto border-4 border-black rounded-lg bg-white flex items-center justify-center">
                        <div className="w-12 h-12 rounded-full border-4 border-black"></div>
                      </div>
                    </div>
                  )}
                  <div className="flex justify-center gap-8 mt-8">
                    <button onClick={() => setCurrentCardIndex((prev) => (prev - 1 + totalCards) % totalCards)}>
                      <svg className="w-12 h-12" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M5 12L12 5M5 12L12 19" stroke="black" strokeWidth="3"/>
                      </svg>
                    </button>
                    <button onClick={handleSwipe}>
                      <svg className="w-12 h-12" viewBox="0 0 24 24" fill="none">
                        <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="black" strokeWidth="3"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div className="flex justify-center gap-2 mb-4">
                  {Array.from({ length: totalCards }).map((_, idx) => (
                    <div key={idx} className={`w-3 h-3 rounded-full ${idx === currentCardIndex ? 'bg-white' : 'bg-white/40'}`} />
                  ))}
                </div>
              </div>
            );
          };

          if (isLoading) {
            return (
              <div className="w-full h-screen bg-gradient-to-b from-teal-600 to-blue-300 flex items-center justify-center">
                <div className="text-white text-4xl">Loading...</div>
              </div>
            );
          }

          if (!currentUser || showAuth) {
            return (
              <div className="w-full min-h-screen bg-gradient-to-b from-teal-600 to-blue-300 flex items-center justify-center p-6">
                <div className="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl">
                  <h1 className="text-4xl font-serif text-teal-700 text-center mb-8">Salama</h1>
                  <div className="flex gap-4 mb-6">
                    <button onClick={() => setAuthMode('login')} className={`flex-1 py-3 rounded-full ${authMode === 'login' ? 'bg-teal-600 text-white' : 'bg-gray-200'}`}>
                      Login
                    </button>
                    <button onClick={() => setAuthMode('signup')} className={`flex-1 py-3 rounded-full ${authMode === 'signup' ? 'bg-teal-600 text-white' : 'bg-gray-200'}`}>
                      Sign Up
                    </button>
                  </div>
                  <form onSubmit={handleAuth} className="space-y-4">
                    <input
                      type="text"
                      placeholder="Username"
                      value={authForm.username}
                      onChange={(e) => setAuthForm({...authForm, username: e.target.value})}
                      className="w-full p-4 border-2 border-gray-300 rounded-lg text-lg"
                      required
                    />
                 <div className="relative">
  <input
    type={showPassword ? "text" : "password"}
    placeholder="Password"
    value={authForm.password}
    onChange={(e) => setAuthForm({...authForm, password: e.target.value})}
    className="w-full p-4 border-2 border-gray-300 rounded-lg text-lg pr-12"
    required
  />
  <button
    type="button"
    onClick={() => setShowPassword(!showPassword)}
    className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-600 text-2xl"
  >
    {showPassword ? 'üôà' : 'üëÅÔ∏è'}
  </button>
</div>
                    {authMode === 'signup' && (
                      <>
                        <input
                          type="text"
                          placeholder="Your Name"
                          value={authForm.name}
                          onChange={(e) => setAuthForm({...authForm, name: e.target.value})}
                          className="w-full p-4 border-2 border-gray-300 rounded-lg text-lg"
                          required
                        />
                        <div className="space-y-2">
                          <p className="text-lg font-semibold">Who are you?</p>
                          <label className="flex items-center gap-3 p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                            <input
                              type="radio"
                              name="role"
                              value="care_recipient"
                              onChange={(e) => setAuthForm({...authForm, role: e.target.value})}
                              required
                            />
                            <span className="text-lg">I need care</span>
                          </label>
                          <label className="flex items-center gap-3 p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                            <input
                              type="radio"
                              name="role"
                              value="caregiver"
                              onChange={(e) => setAuthForm({...authForm, role: e.target.value})}
                              required
                            />
                            <span className="text-lg">I provide care</span>
                          </label>
                        </div>
                      </>
                    )}
                    <button type="submit" className="w-full bg-teal-600 text-white py-4 rounded-lg text-lg font-semibold hover:bg-teal-700">
                      {authMode === 'login' ? 'Login' : 'Sign Up'}
                    </button>
                  </form>
                </div>
              </div>
            );
          }return (
            <div className="w-full min-h-screen bg-gradient-to-b from-teal-600 to-blue-300 pb-24 relative">
              {showSidebar && (
                <>
                  <div className="fixed inset-0 bg-black/50 z-40" onClick={() => setShowSidebar(false)} />
                  <div className="fixed left-0 top-0 bottom-0 w-64 bg-teal-600 z-50 p-6 shadow-2xl">
                    <button onClick={() => setShowSidebar(false)} className="absolute top-4 right-4 text-white text-2xl">‚úï</button>
                    <div className="mt-12">
                      <div className="text-center mb-6">
                        <div className="text-6xl mb-2">{currentUser.avatar}</div>
                        <p className="text-white text-xl font-semibold">{currentUser.name}</p>
                        <p className="text-white/80 text-sm">{currentUser.role === 'care_recipient' ? 'Care Recipient' : 'Caregiver'}</p>
                      </div>
                      <button className="w-full text-left text-2xl text-white mb-6 hover:bg-white/20 p-3 rounded">1. Profile</button>
                      <button className="w-full text-left text-2xl text-white mb-6 hover:bg-white/20 p-3 rounded">2. Settings</button>
                      <button onClick={logout} className="w-full text-left text-2xl text-white hover:bg-white/20 p-3 rounded">3. Log Out</button>
                    </div>
                  </div>
                </>
              )}

              {showQRCode && (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-6">
                  <div className="bg-white rounded-3xl p-8 max-w-md">
                    <h2 className="text-3xl font-serif text-center mb-4">Your Care Circle QR Code</h2>
                    <p className="text-center mb-6">Caregivers can scan this to join your care circle!</p>
                    <div id="qr-code-container" className="flex justify-center mb-6"></div>
                    <button onClick={() => setShowQRCode(false)} className="w-full bg-teal-600 text-white py-3 rounded-lg">
                      Close
                    </button>
                  </div>
                </div>
              )}

              {showQRScanner && (
                <div className="fixed inset-0 bg-black z-50 flex flex-col">
                  <div className="p-6 bg-teal-600">
                    <button onClick={() => { setShowQRScanner(false); }} className="text-white text-2xl">‚úï Close Scanner</button>
                  </div>
                  <div id="qr-reader" className="flex-1"></div>
                </div>
              )}

              {chatWith && (
                <div className="fixed inset-0 bg-gradient-to-b from-teal-600 to-blue-300 z-50 flex flex-col">
                  <div className="p-6 flex items-center gap-4 border-b border-white/30">
                    <button onClick={() => setChatWith(null)} className="text-white text-3xl">‚Üê</button>
                    <div className="flex items-center gap-3">
                      <div className="w-12 h-12 rounded-full border-2 border-white bg-teal-400 flex items-center justify-center">
                        <span className="text-2xl">{chatWith.avatar || 'üë§'}</span>
                      </div>
                      <h2 className="text-2xl font-serif text-white">{chatWith.name}</h2>
                    </div>
                    <button onClick={() => alert('üö® SOS ALERT!')} className="ml-auto w-16 h-16 rounded-3xl bg-red-500 flex items-center justify-center">
                      <span className="text-white text-xl font-bold">SOS</span>
                    </button>
                  </div>
                  <div className="flex-1 overflow-y-auto p-6 space-y-4">
                    {chatMessages.map((msg, idx) => (
                      <div key={idx} className={`flex ${msg.sender === 'me' ? 'justify-end' : 'justify-start'}`}>
                        <div className={`max-w-[70%] rounded-2xl p-4 ${msg.sender === 'me' ? 'bg-teal-700' : 'bg-teal-500'}`}>
                          <p className="text-white text-lg">{msg.text}</p>
                          <span className="text-white/70 text-xs mt-1 block">{msg.time}</span>
                        </div>
                      </div>
                    ))}
                  </div>
                  <div className="p-4 border-t border-white/30">
                    <div className="flex items-center gap-3 bg-teal-700 rounded-full px-4 py-3">
                      <Keyboard className="w-6 h-6 text-white" />
                      <input
                        type="text"
                        value={messageInput}
                        onChange={(e) => setMessageInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                        placeholder="(Text)"
                        className="flex-1 bg-transparent text-white text-lg outline-none placeholder-white/50"
                      />
                      <button onClick={sendMessage}>
                        <Mic className="w-6 h-6 text-white" />
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {showProtectionChat && (
                <div className="fixed inset-0 bg-gradient-to-b from-teal-600 to-blue-300 z-50 flex flex-col">
                  <div className="p-6 flex items-center gap-4 border-b border-white/30">
                    <button onClick={() => setShowProtectionChat(false)} className="text-white text-3xl">‚Üê</button>
                    <div className="flex items-center gap-3 flex-1">
                      <div className="w-12 h-12 rounded-full bg-purple-500 flex items-center justify-center">
                        <span className="text-2xl">üõ°Ô∏è</span>
                      </div>
                      <div>
                        <h2 className="text-2xl font-serif text-white">Salama Protection</h2>
                        <p className="text-sm text-white/80">Ask about anything suspicious</p>
                      </div>
                    </div>
                    <button onClick={() => alert('üö® SOS ALERT!')} className="w-16 h-16 rounded-3xl bg-red-500 flex items-center justify-center">
                      <span className="text-white text-xl font-bold">SOS</span>
                    </button>
                  </div>
                  <div className="flex-1 overflow-y-auto p-6 space-y-4">
                    {protectionMessages.length === 0 ? (
                      <div className="text-center mt-12">
                        <div className="w-24 h-24 bg-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                          <span className="text-5xl">üõ°Ô∏è</span>
                        </div>
                        <h3 className="text-2xl text-white font-serif mb-4">I'm here to protect you</h3>
                        <p className="text-lg text-white/90 mb-6">Ask me about:</p>
                        <div className="space-y-2 text-left max-w-md mx-auto">
                          <p className="text-white">‚Ä¢ Suspicious phone calls</p>
                          <p className="text-white">‚Ä¢ Strange messages or emails</p>
                          <p className="text-white">‚Ä¢ Unexpected visitors</p>
                          <p className="text-white">‚Ä¢ Anything that doesn't feel right</p>
                        </div>
                      </div>
                    ) : (
                      protectionMessages.map((msg, idx) => (
                        <div key={idx} className={`flex ${msg.sender === 'me' ? 'justify-end' : 'justify-start'}`}>
                          <div className={`max-w-[80%] rounded-2xl p-4 ${msg.sender === 'me' ? 'bg-teal-700' : 'bg-purple-600'}`}>
                            {msg.sender === 'salama' && (
                              <div className="flex items-center gap-2 mb-2">
                                <span className="text-xl">üõ°Ô∏è</span>
                                <span className="text-white font-semibold text-sm">Salama AI</span>
                              </div>
                            )}
                            <p className="text-white text-lg whitespace-pre-line">{msg.text}</p>
                            <span className="text-white/70 text-xs mt-1 block">{msg.time}</span>
                          </div>
                        </div>
                      ))
                    )}
                    {isAIThinking && (
                      <div className="flex justify-start">
                        <div className="bg-purple-600 rounded-2xl p-4">
                          <div className="flex items-center gap-2">
                            <div className="flex gap-1">
                              <div className="w-2 h-2 bg-white rounded-full animate-bounce"></div>
                              <div className="w-2 h-2 bg-white rounded-full animate-bounce" style={{animationDelay: '150ms'}}></div>
                              <div className="w-2 h-2 bg-white rounded-full animate-bounce" style={{animationDelay: '300ms'}}></div>
                            </div>
                            <span className="text-white text-sm">Analyzing...</span>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                  <div className="p-4 border-t border-white/30">
                    <div className="flex items-center gap-3 bg-teal-700 rounded-full px-4 py-3 mb-3">
                      <Keyboard className="w-6 h-6 text-white" />
                      <input
                        type="text"
                        value={protectionInput}
                        onChange={(e) => setProtectionInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && protectionInput.trim() && askSalama(protectionInput)}
                        placeholder="(Text)"
                        className="flex-1 bg-transparent text-white text-lg outline-none placeholder-white/50"
                      />
                      <button onClick={() => protectionInput.trim() && askSalama(protectionInput)}>
                        <Mic className="w-6 h-6 text-white" />
                      </button>
                    </div>
           <div className="flex gap-2 flex-wrap">
  <button onClick={() => askSalama("I'm feeling lonely")} className="px-4 py-2 bg-white/20 rounded-full text-white text-sm">
    I'm lonely
  </button>
  <button onClick={() => askSalama("Tell me a joke")} className="px-4 py-2 bg-white/20 rounded-full text-white text-sm">
    Tell me a joke
  </button>
  <button onClick={() => askSalama("Suspicious phone call")} className="px-4 py-2 bg-white/20 rounded-full text-white text-sm">
    Safety concern
  </button>
  <button onClick={() => askSalama("What's the weather like?")} className="px-4 py-2 bg-white/20 rounded-full text-white text-sm">
    Weather
  </button>
</div>
                  </div>
                </div>
              )}

              {showCommunities && (
                <div className="fixed inset-0 bg-gradient-to-b from-teal-600 to-blue-300 z-50 pb-24">
                  <div className="p-6">
                    <div className="flex items-center gap-4 mb-8">
                      <button onClick={() => setShowCommunities(false)} className="text-white text-3xl">‚Üê</button>
                      <div className="flex items-center gap-3">
                        <Users className="w-12 h-12 text-black" />
                        <h2 className="text-3xl font-serif text-black">Community</h2>
                      </div>
                      <button onClick={() => alert('üö® SOS ALERT!')} className="ml-auto w-16 h-16 rounded-3xl bg-red-500 flex items-center justify-center">
                        <span className="text-white text-xl font-bold">SOS</span>
                      </button>
                    </div>
                    <h3 className="text-3xl text-black font-serif mb-8 underline">My Communities</h3>
                    <div className="grid grid-cols-2 gap-6 px-4">
                      {communities.map((community) => (
                        <button
                          key={community.id}
                          onClick={() => {
                            setShowCommunities(false);
                            setChatWith({ type: 'community', name: community.name, avatar: 'üë•' });
                          }}
                          className="flex flex-col items-center hover:scale-105 transition-transform"
                        >
                          <div className="w-32 h-32 rounded-full border-4 border-black bg-gradient-to-b from-blue-300 to-blue-200 mb-3 flex items-center justify-center">
                            <Users className="w-16 h-16 text-black" />
                          </div>
                          <p className="text-center text-base text-black font-serif">{community.name}</p>
                        </button>
                      ))}
                    </div>
                  </div>
                </div>
              )}

              {backgroundMonitoring && monitoringAlerts.length > 0 && (
                <div className="fixed top-20 left-4 right-4 z-40">
                  {monitoringAlerts.map((alert, idx) => (
                    <div key={idx} className="bg-orange-500 text-white p-4 rounded-lg shadow-2xl mb-2 animate-pulse">
                      <div className="flex items-start gap-3">
                        <span className="text-2xl">‚ö†Ô∏è</span>
                        <div className="flex-1">
                          <p className="font-semibold mb-1">Background Monitoring Alert</p>
                          <p className="text-sm">{alert.message}</p>
                          <p className="text-xs mt-2 opacity-75">Caregivers notified</p>
                        </div>
                        <button onClick={() => setMonitoringAlerts([])} className="text-white text-xl">‚úï</button>
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {currentPage === 'home' && (
                <div className="p-6">
                  {renderHeader('')}
                  <div className="text-center mb-8">
                    <div className="text-6xl font-bold text-white mb-2">
                      {currentTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false })}
                    </div>
                    <div className="text-3xl text-black font-serif mb-2">Hello {currentUser.name}</div>
                    <div className="text-3xl text-black font-serif">How are you?</div>
                  </div>
                  <h2 className="text-5xl font-serif text-white text-center mb-8">Today's Recap</h2>
                  {renderSwipeCard(homeCards[currentCardIndex])}
                </div>
              )}

              {currentPage === 'checkin' && (
                <div className="p-6">
                  {renderHeader('Check-In')}
                  <div className="mb-8">
                    <h3 className="text-2xl text-black font-serif mb-4">How Am I Feeling?</h3>
                    <div className="flex justify-between items-center mb-4 px-4">
                      {moods.map((mood, idx) => (
                        <button
                          key={idx}
                          onClick={() => setSelectedMood(idx)}
                          className={`w-14 h-14 rounded-full ${mood.color} flex items-center justify-center text-3xl transition-transform ${selectedMood === idx ? 'scale-125' : ''}`}
                        >
                          {mood.emoji}
                        </button>
                      ))}
                    </div>
                    <div className="h-3 bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 rounded-full mx-4"></div>
                  </div>
                  <div className="mb-8">
                    <h3 className="text-3xl text-black font-serif mb-4">Record Your Thoughts</h3>
                    <button onClick={() => setIsRecording(!isRecording)} className="flex items-center gap-4 mb-6">
                      <div className={`w-16 h-16 ${isRecording ? 'bg-red-500' : 'bg-white'} rounded-full flex items-center justify-center transition-colors`}>
                        <Mic className="w-8 h-8 text-teal-700" />
                      </div>
                      <div className="flex-1 h-2 bg-white rounded-full"></div>
                    </button>
                    <button onClick={() => setShowRecordings(!showRecordings)} className="text-2xl text-white font-serif mb-6 flex items-center gap-2">
                      <span>Previous Recordings</span>
                      <span className={`transform transition-transform ${showRecordings ? 'rotate-180' : ''}`}>‚ñº</span>
                    </button>
                    {showRecordings && (
                      <div className="bg-white bg-opacity-30 rounded-lg p-4 mb-6">
                        {recordings.map((rec, idx) => (
                          <button key={idx} className="w-full text-left text-lg text-black mb-2 hover:text-white transition-colors">
                            {rec}
                          </button>
                        ))}
                      </div>
                    )}
                  </div>
                  <div>
                    <h3 className="text-3xl text-black font-serif mb-6">Memories</h3>
                    <div className="grid grid-cols-3 gap-4 px-4">
                      {[1,2,3,4,5,6].map((i) => (
                        <button key={i} className="aspect-square bg-white rounded-lg border-4 border-black flex items-center justify-center hover:scale-105 transition-transform">
                          <div className="text-center">
                            <div className="w-8 h-8 rounded-full border-2 border-black mx-auto mb-2"></div>
                            <div className="w-12 h-1 bg-black mx-auto mb-1"></div>
                            <div className="w-10 h-1 bg-black mx-auto"></div>
                          </div>
                        </button>
                      ))}
                    </div>
                  </div>
                </div>
              )}

              {currentPage === 'carenotes' && (
                <div className="p-6">
                  {renderHeader('Care Notes')}
                  <div className="mt-20">
                    {renderSwipeCard(careNotesCards[currentCardIndex])}
                  </div>
                </div>
              )}

              {currentPage === 'safety' && (
                <div className="p-6">
                  <div className="flex justify-between items-center mb-12">
                    <button onClick={() => setShowSidebar(true)} className="w-14 h-14 rounded-full border-2 border-white flex items-center justify-center">
                      <User className="w-8 h-8 text-white" />
                    </button>
                    <h1 className="text-4xl font-serif text-white">Safety</h1>
                    <div className="w-14"></div>
                  </div>
                  <div className="flex justify-center gap-8 mb-12">
                    <button onClick={() => { setOkPressed(true); setTimeout(() => setOkPressed(false), 300); alert('OK status sent!'); }} className={`w-40 h-40 rounded-3xl bg-green-500 flex items-center justify-center shadow-2xl transition-all ${okPressed ? 'scale-95' : 'hover:scale-105'}`}>
                      <span className="text-white text-5xl font-bold">OK</span>
                    </button>
                    <button onClick={() => { setSosPressed(true); setTimeout(() => setSosPressed(false), 300); alert('üö® SOS ALERT!'); }} className={`w-40 h-40 rounded-3xl bg-red-500 flex items-center justify-center shadow-2xl transition-all ${sosPressed ? 'scale-95 animate-pulse' : 'hover:scale-105'}`}>
                      <span className="text-white text-5xl font-bold">SOS</span>
                    </button>
                  </div>
                  <div className="mb-8">
                    <h3 className="text-3xl text-black font-serif mb-4 underline">Quick Texts</h3>
                    {quickTexts.map((text, idx) => (
                      <button key={idx} className="w-full text-left text-xl text-black mb-3 hover:text-white transition-colors">
                        {idx + 1}. {text}
                      </button>
                    ))}
                  </div>
                  <div className="mb-8">
                    <h3 className="text-3xl text-black font-serif mb-4 underline">Protection</h3>
                    <p className="text-lg text-black mb-4 italic">(Ask Salama about anything suspicious)</p>
                    <button onClick={() => setShowProtectionChat(true)} className="flex items-center gap-2 text-xl text-black mb-3 hover:text-white transition-colors">
                      <Mic className="w-6 h-6" />
                      <span>‚Ä¢ Speak</span>
                    </button>
                    <button onClick={() => setShowProtectionChat(true)} className="flex items-center gap-2 text-xl text-black hover:text-white transition-colors">
                      <Keyboard className="w-6 h-6" />
                      <span>‚Ä¢ Type</span>
                    </button>
                    <div className="mt-6 bg-white/30 rounded-lg p-4">
                      <div className="flex items-center justify-between mb-2">
                        <div className="flex items-center gap-2">
                          <span className="text-2xl">ü§ñ</span>
                          <span className="text-lg font-semibold text-black">Background Monitoring</span>
                        </div>
                        <button onClick={() => setBackgroundMonitoring(!backgroundMonitoring)} className={`w-14 h-7 rounded-full ${backgroundMonitoring ? 'bg-green-500' : 'bg-gray-400'}`}>
                          <div className={`w-6 h-6 bg-white rounded-full transition-transform ${backgroundMonitoring ? 'translate-x-7' : 'translate-x-0.5'}`} />
                        </button>
                      </div>
                      <p className="text-sm text-black">
                        {backgroundMonitoring ? '‚úì AI monitoring active' : 'Tap to enable monitoring'}
                      </p>
                    </div>
                    <button onClick={() => { setMonitoringAlerts([{ message: "Irregular breathing detected. Heart rate: 95 bpm." }]); setTimeout(() => setMonitoringAlerts([]), 10000); }} className="mt-4 w-full bg-orange-500 text-white px-4 py-2 rounded-lg text-sm">
                      üî¨ Demo: Trigger Alert
                    </button>
                  </div>
                </div>
              )}

              {currentPage === 'carecircle' && (
                <div className="p-6">
                  {renderHeader('Care Circle')}
                  
                  {currentUser.role === 'care_recipient' && (
                    <div className="mb-8 text-center">
                      <button onClick={() => { generateQRCode(currentUser.care_circle_id); setShowQRCode(true); }} className="bg-white text-teal-700 px-6 py-3 rounded-full text-lg font-semibold mb-4">
                        üì± Show My QR Code
                      </button>
                      <p className="text-white">Share this with caregivers to add them to your circle</p>
                    </div>
                  )}

                  {currentUser.role === 'caregiver' && (
                    <div className="mb-8 text-center">
                      <button onClick={startQRScanner} className="bg-white text-teal-700 px-6 py-3 rounded-full text-lg font-semibold mb-4">
                        üì∑ Scan QR Code
                      </button>
                      <p className="text-white">Scan a care recipient's QR code to join their circle</p>
                    </div>
                  )}

                  {caregivers.length > 0 && (
                    <>
                      <h3 className="text-3xl text-white font-serif mb-6 text-center">My Caregivers</h3>
                      <div className="grid grid-cols-2 gap-6 px-8">
                        {caregivers.map((cg) => (
                          <button key={cg.id} onClick={() => { setChatWith(cg); loadMessages(cg.id); }} className="flex flex-col items-center hover:scale-105 transition-transform">
                            <div className="w-32 h-32 rounded-full border-4 border-black bg-gradient-to-b from-teal-400 to-teal-300 mb-3 flex items-center justify-center">
                              <span className="text-5xl">{cg.avatar}</span>
                            </div>
                            <p className="text-center text-lg text-black font-serif">{cg.name}</p>
                          </button>
                        ))}
                      </div>
                    </>
                  )}

                  <div className="mt-8">
                    <button onClick={() => setShowCommunities(true)} className="flex flex-col items-center hover:scale-105 transition-transform mx-auto">
                      <div className="w-32 h-32 rounded-full border-4 border-black bg-gradient-to-b from-blue-300 to-blue-200 mb-3 flex items-center justify-center">
                        <Users className="w-16 h-16 text-black" />
                      </div>
                      <p className="text-center text-lg text-black font-serif">Community</p>
                    </button>
                  </div>
                </div>
              )}

              {renderNavBar()}
            </div>
          );
        };

        ReactDOM.render(<SalamaApp />, document.getElementById('root'));
    </script>
</body>
</html>

